<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>C/3移动平台</title>
    <style>
        .stateOrder {
            border-color: #ff961e;
            color: #ff961e;
            font-size: 0.28rem;
        }
    </style>
    <link rel="stylesheet" href="css/bx-cover.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/header.css">
    <link rel="stylesheet" href="css/infolist.css">
    <script src="js/jquery-1.8.3.min.js"></script>
    <script src="js/rem.js"></script>
    <script src="js/base.js"></script>
    <script src="js/genericScript.js"></script>
    <script type="text/javascript">
        //var localStorage = window.localStorage;
        function QHYG() {
            //$.cookie("STToken", "", { expires: -1 });
            //$.cookie("authorization", "", { expires: -1 });
            localStorage.removeItem("authorization");
            localStorage.removeItem("STToken");
            localStorage.removeItem("userr");
            localStorage.removeItem("Mudown");
            localStorage.removeItem("UntOwn");
            localStorage.removeItem("Prntown");
            localStorage.removeItem("Caption");
            window.location.href = "login.html";
        }

        function MUSY() {
            window.location.href = "index.html";
        }
        function MULB() {
            window.location.href = "infolist.html";
        }
        function MUXX() {
            window.location.href = "infolist.html";
        }
        function MUWD() {
            window.location.href = "me.html";
        }
    </script>
</head>
<body class='main'>
    <header class="clearfix bg">
        <div class="top clearfix">
            <div class="pull-left" id="oTitle">
                审批
            </div>
            <div class="pull-right">
                <a href="#"><img src="image/header_tr.png" alt=""></a>
                <ul>
                    <li><a href="#">用户参数</a></li>
                    <li><a href="#">修改密码</a></li>
                    <li><a href="javascript:QHYG();">重新登录</a></li>
                    <li><a href="#">升级</a></li>
                    <li><a href="#">注册信息</a></li>
                    <li><a href="#">联系我们</a></li>
                </ul>
            </div>
        </div>
        <div class="search-box clearfix">
            <input type="text" placeholder="搜索单号/类型/状态">
            <a href="#" class="pull-right"><img src="image/search.png" alt=""></a>
        </div>
    </header>
    <div class="infolist content">
        <div class="btn">
            <ul class="clearfix">
                <li class="active"><a href="#">待处理</a></li>
                <li><a href="#">已处理</a></li>
                <li><a href="#">我发起</a></li>
            </ul>
        </div>
        <div class="list_box">
            <div class="list">
                <ul id="auditUl"></ul>
            </div>
            <div class="list">
                <ul id="auditUIHistory">
                
                </ul>
            </div>
            <div class="list">
                <ul>
                    <!--<li>
                        <a href="#">
                            <div class="clearfix">
                                <div class="pull-left name">
                                    <h1>材料采购单<span class="state3">已撤销</span></h1>
                                </div>
                                <div class="pull-right date">
                                    2019-09-27
                                </div>
                            </div>
                            <div class="num">RR190825034</div>
                            <div class="people">提交人：管理员</div>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <div class="clearfix">
                                <div class="pull-left name">
                                    <h1>综合领用单<span class="state1">申批中</span></h1>
                                </div>
                                <div class="pull-right date">
                                    2019-11-04
                                </div>
                            </div>
                            <div class="num">MD190601119</div>
                            <div class="people">提交人：管理员</div>
                        </a>
                    </li>
                    <li>
                        <a href="#">
                            <div class="clearfix">
                                <div class="pull-left name">
                                    <h1>材料采购单<span class="state2">已通过</span></h1>
                                </div>
                                <div class="pull-right date">
                                    2019-10-11
                                </div>
                            </div>
                            <div class="num">RR190522026</div>
                            <div class="people">提交人：管理员</div>
                        </a>
                    </li>-->
                </ul>
            </div>
        </div>
    </div>
    <nav>
        <ul class="clearfix">
            <li>
                <a href="javascript:MUSY();">
                    <img src="image/nav_icon1.png" alt="">
                    <p>首页</p>
                </a>
            </li>
            <li>
                <a href="javascript:MULB();">
                    <img src="image/nav_icon2.png" alt="">
                    <p>列表</p>
                </a>
            </li>
            <li class="active">
                <a href="javascript:MUXX();">
                    <img src="image/nav_icon3_active.png" alt="">
                    <p>消息</p>
                </a>
            </li>
            <li>
                <a href="javascript:MUWD();">
                    <img src="image/nav_icon4.png" alt="">
                    <p>我的</p>
                </a>
            </li>
        </ul>
    </nav>

    <script src="layui/layui.all.js"></script>
    <script type="text/javascript">
        var form = layui.form
            , layedit = layui.layedit, laydate = layui.laydate, $ = layui.$;

        
        function AuditHReport(gt_wn, itm_wn, itm_cap, itm_n, itm_st, oth_sql, itm_mak) {
            var authorization = localStorage.getItem("authorization");
            var STToken = localStorage.getItem("STToken");
            var userr = localStorage.getItem("userr");
            window.location.href = "aph.html?Title=" + encodeURIComponent(itm_cap)
                + "&item_st=" + encodeURIComponent(itm_st)
                + "&itm_wn=" + encodeURIComponent(itm_wn)
                + "&gat_wn=" + encodeURIComponent(gt_wn)
                + "&itm_mak=" + encodeURIComponent(itm_mak)
                + "&oth_sql=" + oth_sql
                + "&item_n=" + itm_n;
        }
        function AuditReport(gt_wn, itm_wn, itm_cap, itm_n, itm_st, oth_sql, itm_mak, FdMenu) {
            
            //window.location.href = "audit.html"
            var authorization = localStorage.getItem("authorization");
            var STToken = localStorage.getItem("STToken");
            var userr = localStorage.getItem("userr");
            window.location.href = "approval.html?Title=" + encodeURIComponent(itm_cap)
                + "&item_st=" + encodeURIComponent(itm_st)
                + "&itm_wn=" + encodeURIComponent(itm_wn)
                + "&gat_wn=" + encodeURIComponent(gt_wn)
                + "&itm_mak=" + encodeURIComponent(itm_mak)
                + "&oth_sql=" + oth_sql
                + "&FdMenu=" + FdMenu
                + "&item_n=" + itm_n;



            //var loadIndex = -1;
            //$.ajax({
            //    type: "Get",
            //    url: Common.getRemotePort() + "Audit/ReportImage" + Common.jsNC2(),
            //    data: { 'UserName': userr, 'Param': itm_n, 'Shwn': gt_wn },
            //    headers: {
            //        'Authorization': 'Bearer ' + authorization,
            //        'STToken': STToken
            //    },
            //    beforeSend: function (request) {
            //        loadIndex = layer.load(1, { shade: [0.8, '#393D49'] });
            //    },
            //    complete: function () {
            //        layer.close(loadIndex);
            //    },
            //    success: function (data) {
            //        var returnValue = eval(data);
            //        if (returnValue.Code == 0) {
            //            window.location.href = "audit.html?ImagePath=" + encodeURIComponent(returnValue.ImagePath)
            //                + "&Title=" + itm_cap
            //                + "&item_st=" + encodeURIComponent(itm_st)
            //                + "&gt_wn=" + encodeURIComponent(gt_wn)
            //                + "&item_n=" + encodeURIComponent(itm_n);
            //        }
            //        else {
            //            layer.msg(returnValue.Message);
            //        }
            //    },
            //    error: function (XMLHttpRequest, textStatus, errorThrown) {
            //        if (textStatus == "error") {
            //            layer.msg("网络异常:" + XMLHttpRequest.status);
            //        }
            //        layer.close(loadIndex);
            //    }
            //});
        }

        layer.ready(function () {
            localStorage.setItem("ISLoadImage", "No");
            Common.CheckUserLogin();
            var authorization = localStorage.getItem("authorization");
            var STToken = localStorage.getItem("STToken");
            var userr = localStorage.getItem("userr");
            //var authorization = $.cookie('authorization');
            //var STToken = $.cookie('STToken');
            if (!authorization || !STToken) {
                window.location.href = "login.html";
            }
            else if (authorization == '' || STToken == '') {
                window.location.href = "login.html";
            }
            else {

            }
            //var Mudown = localStorage.getItem("Mudown");
            $.ajax({
                type: "Get",
                url: Common.getRemotePort() + "Item/ItemList" + Common.jsNC2(),
                data: { 'UserName': userr, 'Sty': 3 },
                headers: {
                    'Authorization': 'Bearer ' + authorization,
                    'STToken': STToken
                },
                success: function (data) {
                    $("#auditUl").empty();
                    $("#auditUIHistory").empty();
                    var returnValue = eval(data);
                    if (returnValue.Code == 1) {
                        $.each(returnValue.items, function (n, item) {//
                            if (item.itm_s == 0) {
                                var liParent = $("<li ondblclick=AuditReport('" + item.gt_wn + "','" + item.itm_wn + "','" + item.itm_cap + "','" + item.itm_n + "','" + item.itm_st + "','" + encodeURIComponent(item.oth_sql) + "','" + item.itm_mak + "','" + item.FdMenu + "') ></li>");
                                var aParent = $("<a href=\"javascript:\"></a>");
                                var divParent = $("<div class=\"clearfix\"></div>");
                                var divLeft = $("<div class=\"pull-left name\"></div>");
                                var divH1 = $("<h1>" + item.itm_cap + "<span class=\"state1\">申批中</span></h1>");
                                var divRight = $("<div class=\"pull-right date\">" + item.oth_sql + "</div>");

                                divLeft.append(divH1);
                                divParent.append(divLeft);
                                divParent.append(divRight);
                                aParent.append(divParent);

                                var divParentDown = $("<div class=\"clearfix\"></div>");
                                var divLeftDown = $("<div class=\"pull-left num\">" + item.itm_n + "</div>");
                                var divParentRight = $("<div class=\"pull-right stateOrder\">" + item.itm_st + "</div>");

                                divParentDown.append(divLeftDown);
                                divParentDown.append(divParentRight);
                                aParent.append(divParentDown);

                                var divParentUser = $("<div class=\"people\">提交人：" + item.itm_mak + "</div>");
                                aParent.append(divParentUser);

                                liParent.append(aParent);
                                $("#auditUl").append(liParent);
                            }
                            else {
                                var liParent = $("<li ondblclick=AuditHReport('" + item.gt_wn + "','" + item.itm_wn + "','" + item.itm_cap + "','" + item.itm_n + "','" + item.itm_st + "','" + encodeURIComponent(item.oth_sql) + "','" + item.itm_mak + "') ></li>");
                                var aParent = $("<a href=\"javascript:\"></a>");
                                var divParent = $("<div class=\"clearfix\"></div>");
                                var divLeft = $("<div class=\"pull-left name\"></div>");
                                var divH1 = $("<h1>" + item.itm_cap + "<span class=\"state2\">已通过</span></h1>");
                                var divRight = $("<div class=\"pull-right date\">" + item.oth_sql + "</div>");

                                divLeft.append(divH1);
                                divParent.append(divLeft);
                                divParent.append(divRight);
                                aParent.append(divParent);

                                var divParentDown = $("<div class=\"clearfix\"></div>");
                                var divLeftDown = $("<div class=\"pull-left num\">" + item.itm_n + "</div>");
                                var divParentRight = $("<div class=\"pull-right stateOrder\">" + item.itm_st + "</div>");

                                divParentDown.append(divLeftDown);
                                divParentDown.append(divParentRight);
                                aParent.append(divParentDown);

                                var divParentUser = $("<div class=\"people\">提交人：" + item.itm_mak + "</div>");
                                aParent.append(divParentUser);

                                liParent.append(aParent);
                                $("#auditUIHistory").append(liParent);
                            }
                            
                        });
                    }
                    else {
                        layer.msg(returnValue.Message);
                    }
                },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    if (textStatus == "error") {
                        layer.msg("网络异常:" + XMLHttpRequest.status);
                    }
                }
            });
        });
    </script>
</body>
</html>
